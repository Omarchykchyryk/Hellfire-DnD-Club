<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Таблица</title>
</head>
<body>

<div id="table"></div>

<script>
async function loadTable() {
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTtRpwz0K4XzMujJbHQm7BkiseYA8Id2qIw6jGVsU-VeXGhJQXib0ThjY4WP3FEh3H2z2o9OgkVGRbQ/pub?output=csv";

    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Fetch failed");
        const text = await response.text();

        let rows = text.trim().split("\n").map(r => r.split(","));

        let html = "<table border='1' cellspacing='0' cellpadding='4'>";

        // Первая строка – заголовки
        html += "<tr>";
        rows[0].forEach(h => html += `<th>${h}</th>`);
        html += "</tr>";

        // Начинаем со второй строки
        for (let r = 1; r < rows.length; r++) {
            html += "<tr>";

            for (let c = 0; c < rows[r].length; c++) {
                // Пропускаем ячейки, которые уже были объединены
                if (rows[r][c] === "__skip__") continue;

                let value = rows[r][c];
                let rowspan = 1;

                // Смотрим вниз, чтобы найти одинаковые ячейки
                let nextRow = r + 1;
                while (
                    nextRow < rows.length &&
                    rows[nextRow][c] === value &&
                    value !== "" &&
                    c !== 0 // НЕНУЖНО объединять колонку Время
                ) {
                    rowspan++;
                    rows[nextRow][c] = "__skip__"; // помечаем как поглощённую
                    nextRow++;
                }

                // Генерим ячейку
                if (rowspan > 1)
                    html += `<td rowspan="${rowspan}">${value}</td>`;
                else
                    html += `<td>${value}</td>`;
            }

            html += "</tr>";
        }

        html += "</table>";
        document.getElementById("table").innerHTML = html;

    } catch (e) {
        console.log(e);
        document.getElementById("table").innerHTML = "Ошибка загрузки данных";
    }
}

loadTable();
setInterval(loadTable, 5000);
</script>
<p>Не работает твоя пурга</p>
</body>
</html>
